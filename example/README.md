# Examples

The Example module contains all the example specific modules:

- [hr-data-generator](hr-data-generator/README.md), which can create a fake sample dataset based around possible data that a company might hold about its employees.
- example-model, contains all the deployment agnostic example code such as the rules and example configuration.
- [example-services](example-services/README.md), contains all the example JVM REST based services
- deployment, contains all the deployment specific code and scripts
- [performance](performance/README.md), which provides a performance benchmarking tool

The example demonstrates different users querying an avro file over a REST api.

The queried file is a generated HR dataset of Employee records, generated by the [hr-data-generator](hr-data-generator/README.md). Here is the format of the Employee class:  
    private UserId uid;  
    private String name;  
    private String dateOfBirth;  
    private PhoneNumber[] contactNumbers;  
    private EmergencyContact[] emergencyContacts;  
    private Address address;  
    private BankDetails bankDetails;  
    private String taxCode;  
    private Nationality nationality;  
    private Manager[] manager;  

   The manager field is an array of manager, which could potentially be nested several layers deep, in the generated example manager is nested 3 deep.


The policies and users have been hardcoded in class: uk.gov.gchq.palisade.example.client.ExampleSimpleClient.

Policy have defined the following rules:

1. BankDetailsRule - The bankDetails field should be returned if the user querying the file has completed the PAYROLL_TRAINING_COURSE and the purpose of the query is SALARY  
   In all other cases the bankDetails field should be redacted.

1. DutyOfCareRule - This rule is concerned with the contactNumbers and emergencyContacts fields. These fields should be returned 
    - if the user querying the file has the HR role and the purpose of the query is DUTY_OF_CARE
    - if the user querying the file is the line manager of the Employee record being queried and the purpose of the query is DUTY_OF_CARE  
   In all other cases these fields should be redacted.

1. NationalityRule - The nationality field should be returned if the user querying the file has the HR role and the purpose of the query is STAFF_REPORT    
   In all other cases the nationality field should be redacted.

1. ZipCodeMaskingRule - This rule is concerned with the address field.
    - if the user querying the file has the HR role then the whole address is returned
    - if the purpose of the query is DUTY_OF_CARE and the user querying the file is the line manager of the Employee record being queried then the whole address is returned
    - if the user querying the file has the ESTATES role then the address field should be returned with the zipcode/postcode masked to reduce its precision  
   In all other cases the address field should be redacted.
   
1. RecordMaskingRule - This rule is concerned with the full record.
    - if the user querying the file has the HR role then no modifications are made to the record
    - if the user querying the file has the ESTATES role then no modifications are made to the record
    - if the user is in the management tree of the employee then no modifications are made to the record  
   In all other cases the record will have no information returned.
   
1. FirstResourceRule - This rule is concerned with the resource file that is being requested.
    - if the user has an HR role they will be able to access the first resource file  
   In all other cases the first resource will not be returned to the user.
  
The ExampleConfigurator class creates the users and uses the rule classes mentioned above to create the rules. The example will be run with 3 users:

   - Alice has the role HR and completed the PAYROLL_TRAINING_COURSE
   - Bob has the role ESTATES and not completed any training
   - Eve has the role IT and not completed any training

The example runs several different queries by the different users, with different purposes. When you run the example you will see the data has been redacted in line with the rules.

For deployment specific instructions on how to run the example see:  
- [Local JVM](deployment/local-jvm/README.md) - Runs the example in separate JVM's on the local machine 
- [Local Docker](deployment/local-docker/README.md) - Runs the example in docker containers on the local machine
- [Local Kubernetes](deployment/local-k8s/README.md) - Runs the example in Kubernetes on the local machine
- [AWS-EC2](deployment/AWS-EC2-S3/README.md) - Runs the example on AWS EC2 which demonstrates Palisade integrating into AWS S3
- [AWS-EMR](deployment/AWS-EMR/README.md) - Runs the example using the MapReduce client on the AWS EMR service which demonstrates that Palisade can process large volumes of data when deployed on bare metal as JVM's on a Hadoop cluster.
- [Azure-AKS](deployment/Azure-AKS/README.md) - Runs the example on Azure's Kubernetes as a service, showing that it can be deployed on different architectures and different cloud providers.
